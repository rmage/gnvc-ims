<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="rptSalesReportPerPaymentMethods_xls" pageWidth="612" pageHeight="792" whenNoDataType="AllSectionsNoDetail" columnWidth="552" leftMargin="30" rightMargin="30" topMargin="20" bottomMargin="20">
	<property name="ireport.encoding" value="UTF-8"/>
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.zoom" value="1.5"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<parameter name="P_LOCATION" class="java.lang.String"/>
	<parameter name="P_DEALER_CODE" class="java.lang.String">
		<defaultValueExpression><![CDATA["CUSTOM"]]></defaultValueExpression>
	</parameter>
	<parameter name="P_START_DATE" class="java.lang.String">
		<defaultValueExpression><![CDATA["01/11/2005 00:00:00"]]></defaultValueExpression>
	</parameter>
	<parameter name="P_END_DATE" class="java.lang.String">
		<defaultValueExpression><![CDATA["10/11/2005 00:00:00"]]></defaultValueExpression>
	</parameter>
	<parameter name="P_USERNAME" class="java.lang.String"/>
	<parameter name="P_BG_TYPE" class="java.lang.String"/>
	<queryString>
		<![CDATA[select
	BG_CODE,AREA,BG_NAME,
	trunc(PAYMENT_DATE) as PAYMENT_DATE,
	sum(PAYMENT_AMOUNT) as PAYMENT_AMOUNT,
	METHOD_CODE,RETAIL_OR_POSTPAID,TRANS_TYPE_CODE
from (
SELECT
BG.BG_CODE AS BG_CODE
,BG.NAME as BG_NAME
,BG.BG_TYPE_CODE
,B."NAME" AS AREA
,trunc(SP.DOCUMENT_DATE) AS PAYMENT_DATE -- ambil ini aja,
,SPD.AMOUNT AS PAYMENT_AMOUNT -- JGN AMBIL YG SP, KRN ITU SUMMARY ALL METHOD PAYMENT
,M.METHOD_CODE AS METHOD_CODE
,'SALES RETAIL PAYMENT' AS RETAIL_OR_POSTPAID
,''  AS TRANS_TYPE_CODE
FROM SALES S
INNER JOIN BG BG ON S.BG_CODE=BG.BG_CODE
INNER JOIN BRANCH B ON BG.BRANCH_CODE=B.BRANCH_CODE
INNER JOIN SALES_PAYMENT SP ON S.DOCUMENT_NO=SP.SALES_DOCUMENT_NO
INNER JOIN SALES_PAYMENT_DTL SPD ON SP.DOCUMENT_NO=SPD.DOCUMENT_NO
INNER JOIN PAYMENT_METHOD M ON SPD.METHOD_CODE=M.METHOD_CODE
WHERE S.STATUS_CODE = 'PAID'
UNION ALL
SELECT
BG.BG_CODE AS BG_CODE
,BG.NAME as BG_NAME
,BG.BG_TYPE_CODE
,B."NAME" AS AREA
,trunc(S.DOCUMENT_DATE) AS PAYMENT_DATE -- ambil ini aja,PADANAN POSTPAID ADALAH SALES_PAYMENT, BUKAN SALES
,SPD.AMOUNT AS PAYMENT_AMOUNT -- JGN AMBIL YG SP, KRN ITU SUMMARY ALL METHOD PAYMENT
,M.METHOD_CODE AS METHOD_CODE
,'POSTPAID PAYMENT' AS RETAIL_OR_POSTPAID
,CASE WHEN S.PAYMENT_TYPE IN ('FULL_PAID','LESS_PAID') THEN 'INVOICING' ELSE S.PAYMENT_TYPE END AS TRANS_TYPE_CODE
FROM POSTPAID S
INNER JOIN BG BG ON S.BG_CODE=BG.BG_CODE
INNER JOIN BRANCH B ON BG.BRANCH_CODE=B.BRANCH_CODE
INNER JOIN POSTPAID_DTL SPD ON S.DOCUMENT_NO=SPD.POSTPAID_DOCUMENT_NO
INNER JOIN PAYMENT_METHOD M ON SPD.METHOD_CODE=M.METHOD_CODE
WHERE M.METHOD_CODE <> 'DEPOSIT'
)
where to_date(PAYMENT_DATE,'dd-mm-YY') >= to_date($P{P_START_DATE},'dd-mm-YY')
and to_date(PAYMENT_DATE,'dd-mm-YY') <= to_date($P{P_END_DATE},'dd-mm-YY')
and BG_CODE like $P{P_DEALER_CODE}
and AREA like $P{P_LOCATION}
group by BG_CODE,BG_NAME,AREA,trunc(PAYMENT_DATE),METHOD_CODE,RETAIL_OR_POSTPAID, TRANS_TYPE_CODE
order by BG_CODE,RETAIL_OR_POSTPAID, trunc(PAYMENT_DATE), TRANS_TYPE_CODE, METHOD_CODE]]>
	</queryString>
	<field name="BG_CODE" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="AREA" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="BG_NAME" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="PAYMENT_DATE" class="java.sql.Timestamp">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="PAYMENT_AMOUNT" class="java.math.BigDecimal">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="METHOD_CODE" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="RETAIL_OR_POSTPAID" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="TRANS_TYPE_CODE" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<variable name="paymentAmountSum" class="java.math.BigDecimal" resetType="Group" resetGroup="retailOrPostpaid" calculation="Sum">
		<variableExpression><![CDATA[$F{PAYMENT_AMOUNT}]]></variableExpression>
	</variable>
	<variable name="totalPayment" class="java.math.BigDecimal" resetType="Group" resetGroup="bgCode" calculation="Sum">
		<variableExpression><![CDATA[$F{PAYMENT_AMOUNT}]]></variableExpression>
	</variable>
	<group name="bgCode">
		<groupExpression><![CDATA[$F{BG_CODE}]]></groupExpression>
		<groupHeader>
			<band height="18">
				<textField isBlankWhenNull="true">
					<reportElement x="0" y="0" width="294" height="18"/>
					<textElement verticalAlignment="Middle">
						<font isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{BG_NAME}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="20">
				<staticText>
					<reportElement x="148" y="0" width="146" height="20"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[TOTAL PAYMENT ]]></text>
				</staticText>
				<textField pattern="#,##0.00" isBlankWhenNull="true">
					<reportElement x="420" y="0" width="132" height="20"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font isBold="true"/>
					</textElement>
					<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{totalPayment} != null ? $V{totalPayment} : new BigDecimal(0)]]></textFieldExpression>
				</textField>
				<textField isBlankWhenNull="true">
					<reportElement x="294" y="0" width="126" height="20"/>
					<textElement verticalAlignment="Middle">
						<font isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{BG_CODE}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<group name="retailOrPostpaid">
		<groupExpression><![CDATA[$F{RETAIL_OR_POSTPAID}]]></groupExpression>
		<groupHeader>
			<band height="20">
				<textField isBlankWhenNull="true">
					<reportElement x="0" y="0" width="148" height="20"/>
					<textElement verticalAlignment="Middle">
						<font isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{RETAIL_OR_POSTPAID}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="18">
				<textField pattern="#,##0.00" isBlankWhenNull="true">
					<reportElement x="420" y="0" width="132" height="18"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font isBold="false"/>
					</textElement>
					<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{paymentAmountSum}!=null ? $V{paymentAmountSum} : new BigDecimal(0)]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="0" y="0" width="148" height="18"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font isBold="false"/>
					</textElement>
					<text><![CDATA[SUB TOTAL ]]></text>
				</staticText>
				<textField isBlankWhenNull="true">
					<reportElement x="294" y="0" width="126" height="18"/>
					<textElement verticalAlignment="Middle">
						<font isBold="false"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{BG_CODE}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="148" y="0" width="146" height="18"/>
					<textElement verticalAlignment="Middle"/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{RETAIL_OR_POSTPAID}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="23" splitType="Stretch">
			<staticText>
				<reportElement key="staticText-1" mode="Transparent" x="0" y="0" width="552" height="23" forecolor="#000000" backcolor="#9999FF"/>
				<box leftPadding="5" rightPadding="10">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None" lineSpacing="Single">
					<font fontName="SansSerif" size="18" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[SALES REPORT PER PAYMENT METHODS]]></text>
			</staticText>
		</band>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="22" splitType="Stretch">
			<staticText>
				<reportElement key="staticText-75" mode="Opaque" x="420" y="1" width="132" height="20" forecolor="#000000" backcolor="#EDECEB"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None" lineSpacing="Single">
					<font fontName="SansSerif" size="11" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica-Bold" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Amount]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-61" mode="Opaque" x="0" y="1" width="148" height="20" forecolor="#000000" backcolor="#EDECEB"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None" lineSpacing="Single">
					<font fontName="SansSerif" size="11" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica-Bold" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Sales Date]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-62" mode="Opaque" x="294" y="1" width="126" height="20" forecolor="#000000" backcolor="#EDECEB"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None" lineSpacing="Single">
					<font fontName="SansSerif" size="11" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica-Bold" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Payment Methods]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-62" mode="Opaque" x="148" y="1" width="146" height="20" forecolor="#000000" backcolor="#EDECEB"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None" lineSpacing="Single">
					<font fontName="SansSerif" size="11" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica-Bold" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Payment Types]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="10" splitType="Stretch">
			<textField evaluationTime="Auto" pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement isPrintRepeatedValues="false" x="0" y="0" width="148" height="10" isPrintInFirstWholeBand="true" printWhenGroupChanges="retailOrPostpaid"/>
				<textElement textAlignment="Center">
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.sql.Timestamp"><![CDATA[$F{PAYMENT_DATE}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" evaluationTime="Auto" isBlankWhenNull="true">
				<reportElement x="294" y="0" width="126" height="10"/>
				<textElement textAlignment="Left">
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{METHOD_CODE}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00" isBlankWhenNull="true">
				<reportElement x="420" y="0" width="132" height="10"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{PAYMENT_AMOUNT} != null ? $F{PAYMENT_AMOUNT} : new BigDecimal(0)]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="148" y="0" width="146" height="10"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{TRANS_TYPE_CODE}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band splitType="Stretch"/>
	</pageFooter>
	<lastPageFooter>
		<band height="18">
			<staticText>
				<reportElement key="staticText-22" mode="Transparent" x="0" y="0" width="148" height="18" forecolor="#000000" backcolor="#FFFFFF"/>
				<box leftPadding="5">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#FFFFFF"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Top" rotation="None" lineSpacing="Single">
					<font fontName="SansSerif" size="7" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica-Bold" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Printed by : ]]></text>
			</staticText>
			<textField>
				<reportElement x="148" y="0" width="272" height="18"/>
				<textElement>
					<font size="7"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{P_USERNAME} + ", " +
new SimpleDateFormat("dd-MM-yyyy HH:mm aaa").format(new Date())]]></textFieldExpression>
			</textField>
		</band>
	</lastPageFooter>
</jasperReport>
